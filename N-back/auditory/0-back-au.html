<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0-back-audio</title>
    <link rel="stylesheet" type="text/css" href="../index.css">
</head>

<body>
    <h1 class="title">0-back-audio</h1>
    <div class="game_area">ç‚¹å‡»å±å¹•å¼€å§‹
        <audio id="mp3audio" autoplay>
            <source src="wave/start.wav" type="audio/mpeg" id="beijingyine">
        </audio>
    </div>
    <div class='result'>
        <h2>ğŸ‰æ­å–œğŸ‰</h2>
        <p>æ­£ç¡®ç‚¹å‡»5æ¬¡</p>
        <p>è¯¯ç‚¹å‡»2æ¬¡</p>
        <p>æ¼ç‚¹3æ¬¡</p>
    </div>
</body>
<script>
    // è®¾ç½®å‚æ•°
    var target = 3;//ç›®æ ‡æ•°å­—
    var set_time = 1;//æ¯ä¸ªæ•°å­—å‡ºç°çš„æŒç»­æ—¶é—´

    var ReactTime = [];//ååº”æ—¶é—´å­˜æ”¾çš„æ•°ç»„|0:ä¸éœ€è¦æŒ‰ä¸”æ²¡æŒ‰ï¼›1:éœ€è¦æŒ‰æ²¡æŒ‰ï¼›-1:ä¸éœ€è¦æŒ‰æŒ‰äº†ï¼›å…¶ä»–æ•°å­—ï¼šéœ€è¦æŒ‰ä¸”æŒ‰ä¸‹çš„æ—¶é—´æˆ³
    var success_count = 0;//ç‚¹å‡»æ­£ç¡®çš„æ¬¡æ•°
    var fail_count = 0;//ç‚¹å‡»é”™è¯¯çš„æ¬¡æ•°
    var miss_count=0;//é”™è¿‡ç‚¹å‡»çš„æ¬¡æ•°
    var total_time = 30;//æ¸¸æˆæ€»æ—¶é•¿
    var random_list = [];//éšæœºäº§ç”Ÿçš„æ•°ç»„
    var timer;
    var start_time, end_time;
    var flag = 0;

    var number = document.querySelector('.game_area')
    var audioplay=document.querySelector('#mp3audio');
    var result=document.querySelector('.result')
    result.style.display="none";
    if (total_time > 0) {
        number.addEventListener('click', fn)
    }
    function fn() {
        console.log("ä½ ç‚¹å‡»äº†å¼€å§‹")
        var random_number;
        clearInterval(timer);
        timer = setInterval(function () {
            ReactTime[flag] = 0;
            start_time = Date.now();
            random_number = Math.floor(Math.random() * 10)
            random_list.push(random_number);
            var number_sound="wave/"+random_number+".mp3"
            audioplay.setAttribute('src', number_sound);
            console.log(audioplay.src)
            if (random_number == target) {
                ReactTime[flag] = 1
                document.onclick = function (e) {
                    var evt = e || window.event;
                    var tar = evt.target || evt.srcElement;
                    if (tar == number) {
                        end_time = Date.now();
                        ReactTime[flag - 1] = (end_time - start_time);
                        console.log("ç‚¹å‡»å¯¹äº†", end_time - start_time)
                    }
                }

            }
            if (random_number != target) {
                document.onclick = function (e) {
                    var evt = e || window.event;
                    var tar = evt.target || evt.srcElement;
                    if (tar == number) {
                        ReactTime[flag - 1] = -1
                        console.log("ç‚¹å‡»é”™äº†")
                    }
                }
            }
            flag++;
            total_time--;
            console.log(total_time);
            if (total_time <= 0) {
                clearInterval(timer);
                console.log("React_Time:", ReactTime);
                console.log("random_list", random_list);
                number.removeEventListener('click', fn);
                for(var i=0;i<ReactTime.length;i++){
                        if(ReactTime[i]==1){
                            miss_count++;
                        }
                        else if(ReactTime[i]==-1){
                            fail_count++;
                        }
                        else if(ReactTime[i]==0){

                        }
                        else{
                            success_count++;
                        }
                    }
                    var p1="æ­£ç¡®ç‚¹å‡»"+success_count+"æ¬¡"
                    result.children[1].innerHTML=p1
                    var p2="é”™è¯¯ç‚¹å‡»"+fail_count+"æ¬¡"
                    result.children[2].innerHTML=p2
                    var p3="æ¼ç‚¹"+miss_count+"æ¬¡"
                    result.children[3].innerHTML=p3
                    result.style.display="block";

            }
        }, set_time * 1000)
    }

</script>

</html>